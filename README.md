# ConditionalLove

This repository contains the code and data to reproduce the analysis described in:
de Jonge, M. M. J., Benítez-López, A., Hennekens, S., Santini, L., Huijbregts, M. A. J. & Schipper, A. M. <i>Contitional love? Evidence for the stress gradient hypothesis in dry grasslands across Euope.</i> 

Code and data needed to reproduce the pre-processing steps are not made available due to restrictions on publication of third party data. 

## Model in MATLAB
The following steps should be taken to replicate the Joint-SDMs described in the paper: 

Step 1: Run the main model for 800 runs of 2500 iterations saving only every tenth iteration in MATLAB using run_model(1,800,250,10,3). You can also run the static model with run_static_model(1,800,250,3). The posterior estimates generated by this step are saved in the output folder. WARNING: This step may take a long time, in the order weeks. 

Step 2: Check the convergence the beta parameters of the model using check_convergence('Conditional',1,0) and of the static model using check_convergence('Static',1,0). Trace plots and Gelman-Rubin plots are save in the 'figures' directory. 

Step 3: If the models are converged combine the postiors of the runs after discard the burnin period (600 runs) into one model object and calculate the residual correlations of the species using finalize_model('Conditional',1,600,10) and finalize_model('Static',1,600,10).

From the main top directory of this repository:
```
addpath('MATLAB')
run_static_model(1,800,250,3)
run_model(1,800,250,3)
check_convergence('Static',1,0)
check_convergence('Conditional',1,0)
finalize_model('Static',1,600,10)
finalize_model('Conditional',1,600,10)
```

## Analysis in R
To replicate the analysis of the model and figures, first calculate the mean and confidence intervals of the residual associations along the gradient for the conditional model using meanAssociationGradient(1) and determine for each pairwise association if they differ at the 75th percentile of the gradient as compared to the 25th.

```r
source(file.path('R','meanAssociationGradient.R')
source(file.path('R','associationChange.R')

meanAssociationGradient(1)
associationChange(1)

```

This repository includes the HMSC package V2.1 for MATLAB which can be found at: https://www.helsinki.fi/en/researchgroups/statistical-ecology/software/old-versions-of-hmsc

 
